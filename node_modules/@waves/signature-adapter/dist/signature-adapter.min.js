(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.wavesSignatureAdapter=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var prepareTx_1=require("./prepareTx");var signature_generator_1=require("@waves/signature-generator");var Signable=function(){function Signable(forSign,adapter){var _this=this;this._proofs=[];this._forSign=__assign({},forSign);this._adapter=adapter;this._prepare=prepareTx_1.getSchemaByType(forSign.type);if(!this._forSign.data.timestamp){this._forSign.data.timestamp=Date.now()}if(this._forSign.data.proofs){this._proofs=this._forSign.data.proofs.slice()}if(!this._prepare){if(forSign.type!==prepareTx_1.SIGN_TYPE.CUSTOM){throw new Error("Can't find prepare api for tx type \""+forSign.type+'"!')}else{this._prepare={sign:forSign.signProcessor||function(data){return data},api:forSign.apiProcessor||function(data){return data}}}}var generator;if(forSign.type===prepareTx_1.SIGN_TYPE.CUSTOM){generator=forSign.generator;this._signMethod="signRequest"}else{generator=prepareTx_1.SIGN_TYPES[forSign.type].signatureGenerator;this._signMethod=prepareTx_1.SIGN_TYPES[forSign.type].adapter}if(!generator){throw new Error("Unknown data type "+forSign.type+"!")}this._prepare.sign(forSign.data,true);this._bytePromise=Promise.all([this._adapter.getPublicKey(),this._adapter.getAddress()]).then(function(_a){var senderPublicKey=_a[0],sender=_a[1];var dataForSign=_this._prepare.sign(__assign({sender:sender,senderPublicKey:senderPublicKey},forSign.data));return new generator(dataForSign).getBytes()})}Signable.prototype.getTxData=function(){return __assign({},this._forSign.data)};Signable.prototype.getSignData=function(){return __awaiter(this,void 0,void 0,function(){var senderPublicKey,sender;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this._adapter.getPublicKey()];case 1:senderPublicKey=_a.sent();return[4,this._adapter.getAddress()];case 2:sender=_a.sent();return[2,this._prepare.sign(__assign({sender:sender,senderPublicKey:senderPublicKey},this._forSign.data))]}})})};Signable.prototype.sign2fa=function(options){var _this=this;var code=options.code;return this._adapter.getAddress().then(function(address){return options.request({address:address,code:code,signData:_this._forSign})}).then(function(signature){_this._proofs.push(signature);return _this})};Signable.prototype.addProof=function(signature){if(this._proofs.indexOf(signature)!==-1){this._proofs.push(signature)}return this};Signable.prototype.getId=function(){return this._bytePromise.then(signature_generator_1.utils.crypto.buildTransactionId)};Signable.prototype.sign=function(){var _this=this;this._makeSignPromise();return this._signPromise.then(function(){return _this})};Signable.prototype.getSignature=function(){this._makeSignPromise();return this._signPromise};Signable.prototype.getBytes=function(){return this._bytePromise};Signable.prototype.getMyProofs=function(){var _this=this;return Promise.all([this.getBytes(),this._adapter.getPublicKey()]).then(function(_a){var bytes=_a[0],publicKey=_a[1];return _this._proofs.filter(function(signature){try{return signature_generator_1.utils.crypto.isValidSignature(bytes,signature,publicKey)}catch(e){return false}})})};Signable.prototype.hasMySignature=function(){return this.getMyProofs().then(function(proofs){return!!proofs.length})};Signable.prototype.addMyProof=function(){var _this=this;return this.hasMySignature().then(function(hasMySignature){if(!hasMySignature){return _this.getSignature().then(function(signature){_this._proofs.push(signature);return signature})}else{return _this.getMyProofs().then(function(list){return list[list.length-1]})}})};Signable.prototype.getDataForApi=function(){var _this=this;return Promise.all([this._adapter.getPublicKey(),this._adapter.getAddress(),this.addMyProof()]).then(function(_a){var senderPublicKey=_a[0],sender=_a[1];var proofs=_this._proofs.slice();return _this._prepare.api(__assign({senderPublicKey:senderPublicKey,sender:sender},_this._forSign.data,{proofs:proofs}))})};Signable.prototype._makeSignPromise=function(){var _this=this;if(!this._signPromise){this._signPromise=this._bytePromise.then(function(bytes){return _this._adapter[_this._signMethod](bytes,_this._getAmountPrecision(),_this._forSign)});this._signPromise.catch(function(){_this._signPromise=null})}return this};Signable.prototype._getAmountPrecision=function(){var data=this._forSign.data;return data.amount&&data.amount.asset&&data.amount.asset.precision?data.amount.asset.precision:0};return Signable}();exports.Signable=Signable},{"./prepareTx":14,"@waves/signature-generator":undefined}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var signature_generator_1=require("@waves/signature-generator");var Signable_1=require("../Signable");var Adapter=function(){function Adapter(){this.type=this.constructor.type}Adapter.prototype.makeSignable=function(forSign){return new Signable_1.Signable(forSign,this)};Adapter.prototype.isAvailable=function(){return Promise.resolve()};Adapter.prototype.onDestroy=function(cb){return};Adapter.initOptions=function(options){this._code=options.networkCode;signature_generator_1.config.set({networkByte:options.networkCode})};Adapter.getUserList=function(){return Promise.resolve([])};Adapter.isAvailable=function(){return Promise.resolve(false)};Adapter.type=null;return Adapter}();exports.Adapter=Adapter},{"../Signable":1,"@waves/signature-generator":undefined}],3:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Adapter_1=require("./Adapter");var ledger_1=require("@waves/ledger");var LedgerAdapter=function(_super){__extends(LedgerAdapter,_super);function LedgerAdapter(user){var _this=_super.call(this)||this;_this._currentUser=user;if(!_this._currentUser){throw"No selected user"}return _this}LedgerAdapter.prototype.isAvailable=function(){return this._isMyLedger()};LedgerAdapter.prototype.getPublicKey=function(){return Promise.resolve(this._currentUser.publicKey)};LedgerAdapter.prototype.getAddress=function(){return Promise.resolve(this._currentUser.address)};LedgerAdapter.prototype.getSeed=function(){return Promise.reject(Error('Method "getSeed" is not available!'))};LedgerAdapter.prototype.getAdapterVersion=function(){return LedgerAdapter._ledger.getVersion()};LedgerAdapter.prototype.signRequest=function(bytes){var _this=this;return this._isMyLedger().then(function(){return LedgerAdapter._ledger.signRequest(_this._currentUser.id,bytes)})};LedgerAdapter.prototype.signTransaction=function(bytes,amountPrecision){var _this=this;if(bytes[0]===4){return this.signData(bytes)}return this._isMyLedger().then(function(){return LedgerAdapter._ledger.signTransaction(_this._currentUser.id,{precision:amountPrecision},bytes)})};LedgerAdapter.prototype.signOrder=function(bytes,amountPrecision){var _this=this;return this._isMyLedger().then(function(){return LedgerAdapter._ledger.signOrder(_this._currentUser.id,{precision:amountPrecision},bytes)})};LedgerAdapter.prototype.signData=function(bytes){var _this=this;return this._isMyLedger().then(function(){return LedgerAdapter._ledger.signSomeData(_this._currentUser.id,bytes)})};LedgerAdapter.prototype.getPrivateKey=function(){return Promise.reject("No private key")};LedgerAdapter.prototype._isMyLedger=function(){var _this=this;return LedgerAdapter._ledger.getUserDataById(this._currentUser.id).then(function(user){if(user.address!==_this._currentUser.address){throw{error:"Invalid ledger"}}})};LedgerAdapter.getUserList=function(from,to){if(from===void 0){from=1}if(to===void 0){to=1}return LedgerAdapter._ledger.getPaginationUsersData(from,to)};LedgerAdapter.initOptions=function(options){Adapter_1.Adapter.initOptions(options);this._ledger=new ledger_1.WavesLedger(options)};LedgerAdapter.isAvailable=function(){if(!LedgerAdapter._hasConnectionPromise){LedgerAdapter._hasConnectionPromise=LedgerAdapter._ledger.probeDevice()}return LedgerAdapter._hasConnectionPromise.then(function(){LedgerAdapter._hasConnectionPromise=null;return true},function(err){LedgerAdapter._hasConnectionPromise=null;return false})};LedgerAdapter.type="ledger";return LedgerAdapter}(Adapter_1.Adapter);exports.LedgerAdapter=LedgerAdapter},{"./Adapter":2,"@waves/ledger":undefined}],4:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Adapter_1=require("./Adapter");var signature_generator_1=require("@waves/signature-generator");var SeedAdapter=function(_super){__extends(SeedAdapter,_super);function SeedAdapter(data){var _this=_super.call(this)||this;var seed;if(typeof data==="string"){seed=data}else{var user=data;var encryptionRounds=user.encryptionRounds;seed=signature_generator_1.Seed.decryptSeedPhrase(user.encryptedSeed,user.password,encryptionRounds)}_this.seed=new signature_generator_1.Seed(seed);return _this}SeedAdapter.prototype.getPublicKey=function(){return Promise.resolve(this.seed.keyPair.publicKey)};SeedAdapter.prototype.getPrivateKey=function(){return Promise.resolve(this.seed.keyPair.privateKey)};SeedAdapter.prototype.getAddress=function(){return Promise.resolve(this.seed.address)};SeedAdapter.prototype.getSeed=function(){return Promise.resolve(this.seed.phrase)};SeedAdapter.prototype.signRequest=function(bytes){return this._sign(bytes)};SeedAdapter.prototype.signTransaction=function(bytes,amountPrecision){return this._sign(bytes)};SeedAdapter.prototype.signOrder=function(bytes,amountPrecision){return this._sign(bytes)};SeedAdapter.prototype.signData=function(bytes){return this._sign(bytes)};SeedAdapter.prototype._sign=function(bytes){return Promise.resolve(signature_generator_1.utils.crypto.buildTransactionSignature(bytes,this.seed.keyPair.privateKey))};SeedAdapter.isAvailable=function(){return Promise.resolve(true)};SeedAdapter.type="seed";return SeedAdapter}(Adapter_1.Adapter);exports.SeedAdapter=SeedAdapter},{"./Adapter":2,"@waves/signature-generator":undefined}],5:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Adapter_1=require("./Adapter");var TresorAdapter=function(_super){__extends(TresorAdapter,_super);function TresorAdapter(){return _super!==null&&_super.apply(this,arguments)||this}TresorAdapter.prototype.getPublicKey=function(){return Promise.resolve("")};TresorAdapter.prototype.getAddress=function(){return Promise.resolve("")};TresorAdapter.prototype.getSeed=function(){return Promise.reject(Error('Method "getSeed" is not available!'))};TresorAdapter.prototype.signRequest=function(bytes){return Promise.resolve("")};TresorAdapter.prototype.signTransaction=function(bytes,amountPrecision){return Promise.resolve("")};TresorAdapter.prototype.signOrder=function(bytes,amountPrecision){return Promise.resolve("")};TresorAdapter.prototype.signData=function(bytes){return Promise.resolve("")};TresorAdapter.prototype.getPrivateKey=function(){return Promise.reject("No private key")};TresorAdapter.isAvailable=function(){return Promise.resolve(false)};TresorAdapter.type="tresor";return TresorAdapter}(Adapter_1.Adapter);exports.TresorAdapter=TresorAdapter},{"./Adapter":2}],6:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var Adapter_1=require("./Adapter");var prepareTx_1=require("../prepareTx");var signature_generator_1=require("@waves/signature-generator");var WavesKeeperAdapter=function(_super){__extends(WavesKeeperAdapter,_super);function WavesKeeperAdapter(_a){var address=_a.address,publicKey=_a.publicKey;var _this=_super.call(this)||this;_this._onDestoryCb=[];_this._needDestroy=false;WavesKeeperAdapter._initExtension();_this._address=address;_this._pKey=publicKey;WavesKeeperAdapter.onUpdate(function(state){if(!state.locked&&(!state.account||state.account.address!==_this._address)){_this._needDestroy=true;_this._onDestoryCb.forEach(function(cb){return cb()})}});return _this}WavesKeeperAdapter.prototype.isAvailable=function(ignoreLocked){if(ignoreLocked===void 0){ignoreLocked=false}return __awaiter(this,void 0,void 0,function(){var data,e_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,3,,4]);return[4,WavesKeeperAdapter.isAvailable()];case 1:_a.sent();return[4,WavesKeeperAdapter._api.publicState()];case 2:data=_a.sent();if(data.locked){return[2,ignoreLocked?Promise.resolve():Promise.reject({code:4,msg:"Keeper is locked"})]}if(data.account&&data.account.address===this._address){return[2,Promise.resolve()]}return[3,4];case 3:e_1=_a.sent();return[3,4];case 4:return[2,Promise.reject({code:5,msg:"Keeper has another active account"})]}})})};WavesKeeperAdapter.prototype.isLocked=function(){return __awaiter(this,void 0,void 0,function(){var data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,WavesKeeperAdapter.isAvailable()];case 1:_a.sent();return[4,WavesKeeperAdapter._api.publicState()];case 2:data=_a.sent();if(data.locked){return[2,Promise.resolve()]}return[2]}})})};WavesKeeperAdapter.prototype.onDestroy=function(cb){if(this._needDestroy){return cb()}this._onDestoryCb.push(cb)};WavesKeeperAdapter.prototype.getPublicKey=function(){return Promise.resolve(this._pKey)};WavesKeeperAdapter.prototype.getAddress=function(){return Promise.resolve(this._address)};WavesKeeperAdapter.prototype.getSeed=function(){return Promise.reject(Error('Method "getSeed" is not available!'))};WavesKeeperAdapter.prototype.signRequest=function(bytes,_,signData){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isAvailable(true)];case 1:_a.sent();return[4,WavesKeeperAdapter._api.signRequest(signData)];case 2:return[2,_a.sent()]}})})};WavesKeeperAdapter.prototype.signTransaction=function(bytes,amountPrecision,signData){return __awaiter(this,void 0,void 0,function(){var dataStr,_a,proofs,signature;return __generator(this,function(_b){switch(_b.label){case 0:return[4,this.isAvailable(true)];case 1:_b.sent();return[4,WavesKeeperAdapter._api.signTransaction(signData)];case 2:dataStr=_b.sent();_a=JSON.parse(dataStr),proofs=_a.proofs,signature=_a.signature;return[2,signature||proofs.pop()]}})})};WavesKeeperAdapter.prototype.signOrder=function(bytes,amountPrecision,signData){return __awaiter(this,void 0,void 0,function(){var promise,dataStr,_a,proofs,signature;return __generator(this,function(_b){switch(_b.label){case 0:return[4,this.isAvailable(true)];case 1:_b.sent();switch(signData.type){case prepareTx_1.SIGN_TYPE.CREATE_ORDER:promise=WavesKeeperAdapter._api.signOrder(signData);break;case prepareTx_1.SIGN_TYPE.CANCEL_ORDER:promise=WavesKeeperAdapter._api.signCancelOrder(signData);break;default:return[2,WavesKeeperAdapter._api.signRequest(signData)]}return[4,promise];case 2:dataStr=_b.sent();_a=JSON.parse(dataStr),proofs=_a.proofs,signature=_a.signature;return[2,signature||proofs.pop()]}})})};WavesKeeperAdapter.prototype.signData=function(bytes){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isAvailable(true)];case 1:_a.sent();return[2,Promise.resolve("")]}})})};WavesKeeperAdapter.prototype.getPrivateKey=function(){return Promise.reject("No private key")};WavesKeeperAdapter.isAvailable=function(){return __awaiter(this,void 0,void 0,function(){var error,data,e_2;return __generator(this,function(_a){switch(_a.label){case 0:WavesKeeperAdapter._initExtension();if(!this._api){throw{code:0,message:"Install WavesKeeper"}}_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,this._api.publicState()];case 2:data=_a.sent();return[3,4];case 3:e_2=_a.sent();error={code:1,message:"No permissions"};return[3,4];case 4:if(!error&&data){if(!data.locked&&!data.account){error={code:2,message:"No accounts in waveskeeper"}}else if(!data.locked&&(!data.account.address||!signature_generator_1.utils.crypto.isValidAddress(data.account.address))){error={code:3,message:"Selected network incorrect"}}}if(error){throw error}return[2,true]}})})};WavesKeeperAdapter.getUserList=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,WavesKeeperAdapter.isAvailable()];case 1:_a.sent();return[2,WavesKeeperAdapter._api.publicState().then(function(_a){var account=_a.account;return[account]})]}})})};WavesKeeperAdapter.initOptions=function(options){Adapter_1.Adapter.initOptions(options);this.setApiExtension(options.extension)};WavesKeeperAdapter.setApiExtension=function(extension){var extensionCb;if(typeof extension==="function"){extensionCb=extension}else if(extension){extensionCb=function(){return extension}}WavesKeeperAdapter._getApiCb=extensionCb};WavesKeeperAdapter.onUpdate=function(cb){WavesKeeperAdapter._onUpdateCb.push(cb)};WavesKeeperAdapter._initExtension=function(){if(WavesKeeperAdapter._api||!WavesKeeperAdapter._getApiCb){return null}this._api=WavesKeeperAdapter._getApiCb();if(this._api){this._api.on("update",function(state){for(var _i=0,_a=WavesKeeperAdapter._onUpdateCb;_i<_a.length;_i++){var cb=_a[_i];cb(state)}})}};WavesKeeperAdapter.type="wavesKeeper";WavesKeeperAdapter._onUpdateCb=[];return WavesKeeperAdapter}(Adapter_1.Adapter);exports.WavesKeeperAdapter=WavesKeeperAdapter},{"../prepareTx":14,"./Adapter":2,"@waves/signature-generator":undefined}],7:[function(require,module,exports){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}Object.defineProperty(exports,"__esModule",{value:true});__export(require("./Adapter"));__export(require("./LedgerAdapter"));__export(require("./SeedAdapter"));__export(require("./TresorAdapter"));__export(require("./WavesKeeperAdapter"))},{"./Adapter":2,"./LedgerAdapter":3,"./SeedAdapter":4,"./TresorAdapter":5,"./WavesKeeperAdapter":6}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SeedAdapter_1=require("./adapters/SeedAdapter");var LedgerAdapter_1=require("./adapters/LedgerAdapter");var adapters_1=require("./adapters");exports.adapterPriorityList=["wavesKeeper","ledger","tresor","seed"];exports.adapterList=[SeedAdapter_1.SeedAdapter,LedgerAdapter_1.LedgerAdapter,adapters_1.WavesKeeperAdapter]},{"./adapters":7,"./adapters/LedgerAdapter":3,"./adapters/SeedAdapter":4}],9:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}Object.defineProperty(exports,"__esModule",{value:true});var utils_1=require("./utils");__export(require("./adapters"));__export(require("./prepareTx"));__export(require("./config"));__export(require("./Signable"));var config_1=require("./config");function getAvailableList(){var _this=this;return Promise.all(config_1.adapterPriorityList.map(function(type){return __awaiter(_this,void 0,void 0,function(){var adapter,available;return __generator(this,function(_a){switch(_a.label){case 0:adapter=getAdapterByType(type);return[4,adapter.isAvailable()];case 1:available=_a.sent();return[2,available?adapter:null]}})})})).then(function(list){return list.filter(Boolean)})}exports.getAvailableList=getAvailableList;function getAdapterByType(type){return utils_1.find({type:type},config_1.adapterList)}exports.getAdapterByType=getAdapterByType},{"./Signable":1,"./adapters":7,"./config":8,"./prepareTx":14,"./utils":17}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _a;var signature_generator_1=require("@waves/signature-generator");var TRANSACTION_TYPE_NUMBER;(function(TRANSACTION_TYPE_NUMBER){TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["SEND_OLD"]=2]="SEND_OLD";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["ISSUE"]=3]="ISSUE";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["TRANSFER"]=4]="TRANSFER";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["REISSUE"]=5]="REISSUE";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["BURN"]=6]="BURN";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["EXCHANGE"]=7]="EXCHANGE";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["LEASE"]=8]="LEASE";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["CANCEL_LEASING"]=9]="CANCEL_LEASING";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["CREATE_ALIAS"]=10]="CREATE_ALIAS";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["MASS_TRANSFER"]=11]="MASS_TRANSFER";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["DATA"]=12]="DATA";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["SET_SCRIPT"]=13]="SET_SCRIPT";TRANSACTION_TYPE_NUMBER[TRANSACTION_TYPE_NUMBER["SPONSORSHIP"]=14]="SPONSORSHIP"})(TRANSACTION_TYPE_NUMBER=exports.TRANSACTION_TYPE_NUMBER||(exports.TRANSACTION_TYPE_NUMBER={}));var SIGN_TYPE;(function(SIGN_TYPE){SIGN_TYPE[SIGN_TYPE["AUTH"]=1e3]="AUTH";SIGN_TYPE[SIGN_TYPE["MATCHER_ORDERS"]=1001]="MATCHER_ORDERS";SIGN_TYPE[SIGN_TYPE["CREATE_ORDER"]=1002]="CREATE_ORDER";SIGN_TYPE[SIGN_TYPE["CANCEL_ORDER"]=1003]="CANCEL_ORDER";SIGN_TYPE[SIGN_TYPE["COINOMAT_CONFIRMATION"]=1004]="COINOMAT_CONFIRMATION";SIGN_TYPE[SIGN_TYPE["CUSTOM"]=1005]="CUSTOM";SIGN_TYPE[SIGN_TYPE["ISSUE"]=3]="ISSUE";SIGN_TYPE[SIGN_TYPE["TRANSFER"]=4]="TRANSFER";SIGN_TYPE[SIGN_TYPE["REISSUE"]=5]="REISSUE";SIGN_TYPE[SIGN_TYPE["BURN"]=6]="BURN";SIGN_TYPE[SIGN_TYPE["EXCHANGE"]=7]="EXCHANGE";SIGN_TYPE[SIGN_TYPE["LEASE"]=8]="LEASE";SIGN_TYPE[SIGN_TYPE["CANCEL_LEASING"]=9]="CANCEL_LEASING";SIGN_TYPE[SIGN_TYPE["CREATE_ALIAS"]=10]="CREATE_ALIAS";SIGN_TYPE[SIGN_TYPE["MASS_TRANSFER"]=11]="MASS_TRANSFER";SIGN_TYPE[SIGN_TYPE["DATA"]=12]="DATA";SIGN_TYPE[SIGN_TYPE["SET_SCRIPT"]=13]="SET_SCRIPT";SIGN_TYPE[SIGN_TYPE["SPONSORSHIP"]=14]="SPONSORSHIP"})(SIGN_TYPE=exports.SIGN_TYPE||(exports.SIGN_TYPE={}));exports.SIGN_TYPES=(_a={},_a[SIGN_TYPE.AUTH]={signatureGenerator:signature_generator_1.generate([new signature_generator_1.StringWithLength("prefix"),new signature_generator_1.StringWithLength("host"),new signature_generator_1.StringWithLength("data")]),adapter:"signRequest"},_a[SIGN_TYPE.COINOMAT_CONFIRMATION]={signatureGenerator:signature_generator_1.generate([new signature_generator_1.StringWithLength("prefix"),new signature_generator_1.Long("timestamp")]),adapter:"signRequest"},_a[SIGN_TYPE.MATCHER_ORDERS]={signatureGenerator:signature_generator_1.AUTH_ORDER_SIGNATURE,adapter:"signRequest"},_a[SIGN_TYPE.CREATE_ORDER]={signatureGenerator:signature_generator_1.CREATE_ORDER_SIGNATURE,adapter:"signOrder"},_a[SIGN_TYPE.CANCEL_ORDER]={signatureGenerator:signature_generator_1.CANCEL_ORDER_SIGNATURE,adapter:"signRequest"},_a[SIGN_TYPE.TRANSFER]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.TRANSFER],adapter:"signTransaction"},_a[SIGN_TYPE.ISSUE]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.ISSUE],adapter:"signTransaction"},_a[SIGN_TYPE.REISSUE]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.REISSUE],adapter:"signTransaction"},_a[SIGN_TYPE.BURN]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.BURN],adapter:"signTransaction"},_a[SIGN_TYPE.EXCHANGE]={signatureGenerator:signature_generator_1.generate([new signature_generator_1.StringWithLength("exchange-tx")]),adapter:"signRequest"},_a[SIGN_TYPE.LEASE]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.LEASE],adapter:"signTransaction"},_a[SIGN_TYPE.CANCEL_LEASING]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.CANCEL_LEASING],adapter:"signTransaction"},_a[SIGN_TYPE.CREATE_ALIAS]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.CREATE_ALIAS],adapter:"signTransaction"},_a[SIGN_TYPE.MASS_TRANSFER]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.MASS_TRANSFER],adapter:"signTransaction"},_a[SIGN_TYPE.DATA]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.DATA],adapter:"signTransaction"},_a[SIGN_TYPE.SET_SCRIPT]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.SET_SCRIPT],adapter:"signTransaction"},_a[SIGN_TYPE.SPONSORSHIP]={signatureGenerator:signature_generator_1.TX_NUMBER_MAP[TRANSACTION_TYPE_NUMBER.SPONSORSHIP],adapter:"signTransaction"},_a)},{"@waves/signature-generator":undefined}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var fieldFactory=function(type){return function(fromField,toField,processor,optional){if(toField===void 0){toField=fromField}if(processor===void 0){processor=null}if(optional===void 0){optional=false}return{name:fromField,field:toField||fromField,optional:optional,processor:processor,type:type}}};exports.string=fieldFactory("string");exports.asset=fieldFactory("assetId");exports.assetName=fieldFactory("assetName");exports.assetDescription=fieldFactory("assetDescription");exports.precision=fieldFactory("precision");exports.number=fieldFactory("number");exports.address=fieldFactory("address");exports.aliasName=fieldFactory("aliasName");exports.aliasOrAddress=fieldFactory("aliasOrAddress");exports.money=fieldFactory("money");exports.numberLike=fieldFactory("numberLike");exports.attachment=fieldFactory("attachment");exports.httpsUrl=fieldFactory("httpsUrl");exports.timestamp=fieldFactory("timestamp");exports.orderType=fieldFactory("orderType");exports.fromData=fieldFactory("fromData");exports.boolean=fieldFactory("boolean");exports.transfers=fieldFactory("transfers");exports.data=fieldFactory("data");exports.script=fieldFactory("script");exports.required=fieldFactory("required")},{}],12:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};var __rest=this&&this.__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)if(e.indexOf(p[i])<0)t[p[i]]=s[p[i]];return t};Object.defineProperty(exports,"__esModule",{value:true});var data_entities_1=require("@waves/data-entities");var signature_generator_1=require("@waves/signature-generator");var TRANSFERS={ATTACHMENT:140};var ALIAS={AVAILABLE_CHARS:"-.0123456789@_abcdefghijklmnopqrstuvwxyz",MAX_ALIAS_LENGTH:30,MIN_ALIAS_LENGTH:4};var ADDRESS={MAX_ADDRESS_LENGTH:45};var ASSETS={NAME_MIN_BYTES:4,NAME_MAX_BYTES:16,DESCRIPTION_MAX_BYTES:1e3};exports.ERROR_MSG={REQUIRED:"field is required",WRONG_TYPE:"field is wrong type",WRONG_NUMBER:"field is not number",WRONG_TIMESTAMP:"field is not timestamp",SMALL_FIELD:"field is small",LARGE_FIELD:"field is large",WRONG_SYMBOLS:"field has wrong symbols",WRONG_ADDRESS:"field is wrong address",WRONG_BOOLEAN:"field is wrong boolean",WRONG_ASSET_ID:"field is wrong assetId",WRONG_ORDER_TYPE:'field is wrong order type. Field can be "buy" or "sell"',NOT_HTTPS_URL:"field can be url with https protocol",BASE64:'field can be base64 string with prefix "base64:"'};var isBase64=function(value){var regExp=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/;return regExp.test(value)};var getBytesFromString=function(value){return unescape(encodeURIComponent(value))};var numberToString=function(num){return num&&typeof num==="number"?num.toString():num};var error=function(_a,message){var value=_a.value,options=__rest(_a,["value"]);var field=options.name,type=options.type;throw{value:value,field:field,type:type,message:message}};var required=function(options){var value=options.value,optional=options.optional;if(!optional&&value==null){error(options,exports.ERROR_MSG.REQUIRED)}};var string=function(options){options=__assign({},options,{value:numberToString(options.value)});required(options);var value=options.value,optional=options.optional;if(!optional&&value==null&&(value!=null&&typeof value!=="string")){return error(options,exports.ERROR_MSG.WRONG_TYPE)}};var attachment=function(options){var value=numberToString(options.value);options=__assign({},options,{value:value});string(options);if(value==null){return}switch(true){case typeof value!="string":error(options,exports.ERROR_MSG.WRONG_TYPE);break;case getBytesFromString(value).length>TRANSFERS.ATTACHMENT:error(options,exports.ERROR_MSG.LARGE_FIELD);break}};var number=function(options){required(options);var value=options.value;if(value!=null&&new data_entities_1.BigNumber(value).isNaN()){return error(options,exports.ERROR_MSG.WRONG_NUMBER)}};var boolean=function(options){required(options);var value=options.value;if(value!=null&&typeof value!=="boolean"){return error(options,exports.ERROR_MSG.WRONG_BOOLEAN)}};var money=function(options){required(options);var value=options.value;if(value==null){return}switch(true){case!(value instanceof data_entities_1.Money):return error(options,exports.ERROR_MSG.WRONG_TYPE);case value instanceof data_entities_1.Money&&value.getCoins().isNaN():return error(options,exports.ERROR_MSG.WRONG_NUMBER)}};var numberLike=function(options,min,max){required(options);var value=options.value;if(value==null){return}var checkInterval=function(bigNumber){if(min!=null){if(bigNumber.lt(new data_entities_1.BigNumber(min))){error(options,exports.ERROR_MSG.SMALL_FIELD)}}if(max!=null){if(bigNumber.gt(new data_entities_1.BigNumber(max))){error(options,exports.ERROR_MSG.LARGE_FIELD)}}};switch(true){case value instanceof data_entities_1.BigNumber:if(value.isNaN()){error(options,exports.ERROR_MSG.WRONG_TYPE)}checkInterval(value);break;case value instanceof data_entities_1.Money:var coins=value.getCoins();if(coins.isNaN()){error(options,exports.ERROR_MSG.WRONG_NUMBER)}checkInterval(coins);break;case typeof value==="string"&&!value:error(options,exports.ERROR_MSG.WRONG_NUMBER);break;case new data_entities_1.BigNumber(value).isNaN():return error(options,exports.ERROR_MSG.WRONG_NUMBER);default:checkInterval(new data_entities_1.BigNumber(value))}};var aliasName=function(options){options=__assign({},options,{value:numberToString(options.value)});required(options);var value=options.value;if(value==null){return null}switch(true){case typeof value!=="string":return error(options,exports.ERROR_MSG.WRONG_TYPE);case value.length<ALIAS.MIN_ALIAS_LENGTH:return error(options,exports.ERROR_MSG.SMALL_FIELD);case value.length>ALIAS.MAX_ALIAS_LENGTH:return error(options,exports.ERROR_MSG.LARGE_FIELD);case!value.split("").every(function(char){return ALIAS.AVAILABLE_CHARS.includes(char)}):return error(options,exports.ERROR_MSG.WRONG_SYMBOLS)}};var address=function(options){options=__assign({},options,{value:numberToString(options.value)});required(options);var value=options.value;var isValidAddress=function(address){try{return signature_generator_1.utils.crypto.isValidAddress(address)}catch(e){return false}};if(value==null){return null}switch(true){case typeof value!=="string":return error(options,exports.ERROR_MSG.WRONG_TYPE);case value.length<=ALIAS.MAX_ALIAS_LENGTH:return error(options,exports.ERROR_MSG.SMALL_FIELD);case value.length>ADDRESS.MAX_ADDRESS_LENGTH:return error(options,exports.ERROR_MSG.LARGE_FIELD);case!isValidAddress(value):return error(options,exports.ERROR_MSG.WRONG_ADDRESS)}};var aliasOrAddress=function(options){try{aliasName(options)}catch(e){address(options)}};var assetId=function(options){options=__assign({},options,{value:numberToString(options.value)});required(options);var value=options.value;if(value==null){return null}if(typeof value!=="string"){return error(options,exports.ERROR_MSG.WRONG_TYPE)}var isAssetId=false;try{isAssetId=signature_generator_1.libs.base58.decode(value.trim()).length===32}catch(e){isAssetId=false}if(!isAssetId&&value!=="WAVES"){return error(options,exports.ERROR_MSG.WRONG_ASSET_ID)}};var timestamp=function(options){required(options);var value=options.value;if(value&&!(value instanceof Date||typeof value==="number"||+value)){if(typeof value!=="string"||isNaN(Date.parse(value))){return error(options,exports.ERROR_MSG.WRONG_TIMESTAMP)}}};var orderType=function(options){required(options);var value=options.value;if(value==null){return null}if(typeof value!=="string"){return error(options,exports.ERROR_MSG.WRONG_TYPE)}if(value!=="sell"&&value!=="buy"){return error(options,exports.ERROR_MSG.WRONG_ORDER_TYPE)}};var assetName=function(options){options=__assign({},options,{value:numberToString(options.value)});required(options);var value=options.value;if(value!=null){if(typeof value!=="string"){error(options,exports.ERROR_MSG.WRONG_TYPE)}var bytesLength=getBytesFromString(value).length;if(bytesLength<ASSETS.NAME_MIN_BYTES){error(options,exports.ERROR_MSG.SMALL_FIELD)}if(bytesLength>ASSETS.NAME_MAX_BYTES){error(options,exports.ERROR_MSG.LARGE_FIELD)}}};var assetDescription=function(options){options=__assign({},options,{value:numberToString(options.value)});required(options);var value=options.value;if(value!=null){if(typeof value!=="string"){error(options,exports.ERROR_MSG.WRONG_TYPE)}var bytesLength=getBytesFromString(value).length;if(bytesLength>ASSETS.DESCRIPTION_MAX_BYTES){error(options,exports.ERROR_MSG.LARGE_FIELD)}}};var precision=function(options){required(options);numberLike(options,0,8)};var httpsUrl=function(options){required(options);var value=options.value;var isNotUrl=function(url){try{new URL(url);return false}catch(e){return true}};if(value==null){return null}switch(true){case typeof value!=="string":error(options,exports.ERROR_MSG.WRONG_TYPE);break;case value.indexOf("https://")===-1:error(options,exports.ERROR_MSG.NOT_HTTPS_URL);break;case isNotUrl(value):error(options,exports.ERROR_MSG.NOT_HTTPS_URL);break}};var transfers=function(options){required(options);var value=options.value;if(!Array.isArray(value)){error(options,exports.ERROR_MSG.WRONG_TYPE)}if(!options.optional&&value.length===0){error(options,exports.ERROR_MSG.REQUIRED)}var errors=(value||[]).map(function(_a,index){var recipient=_a.recipient,amount=_a.amount;var dataErrors=[];try{numberLike(__assign({},options,{value:amount,name:options.name+":"+index+":amount",optional:false}))}catch(e){dataErrors.push(e)}try{aliasOrAddress(__assign({},options,{value:recipient,name:options.name+":"+index+":recipient",optional:false}))}catch(e){dataErrors.push(e)}return dataErrors}).filter(function(item){return item.length});if(errors.length){error(options,errors);error(options,errors)}};var data=function(options){required(options);var value=options.value;if(!Array.isArray(value)){error(options,exports.ERROR_MSG.WRONG_TYPE)}var errors=value.map(function(_a,index){var key=_a.key,type=_a.type,value=_a.value;try{string(__assign({},options,{value:key,name:options.name+":"+index+":key",optional:false}))}catch(e){return e}var itemOptions=__assign({},options,{name:options.name+":"+index+":value",optional:false,value:value});try{switch(type){case"integer":numberLike(itemOptions);break;case"boolean":boolean(itemOptions);break;case"binary":binary(itemOptions);break;case"string":string(itemOptions);break;default:error(__assign({},options,{value:key,name:options.name+":"+index+":type"}),exports.ERROR_MSG.WRONG_TYPE)}}catch(e){return e}}).filter(function(item){return item});if(errors.length){error(options,errors)}};var binary=function(options){var _a=options.value,value=_a===void 0?"":_a;if(value&&!value.includes("base64:")){error(options,exports.ERROR_MSG.BASE64)}if(value&&!isBase64(value.replace("base64:",""))){error(options,exports.ERROR_MSG.BASE64)}};var script=function(options){binary(options)};exports.VALIDATORS={string:string,number:number,required:required,numberLike:numberLike,money:money,aliasName:aliasName,address:address,boolean:boolean,assetId:assetId,timestamp:timestamp,orderType:orderType,assetName:assetName,assetDescription:assetDescription,httpsUrl:httpsUrl,attachment:attachment,transfers:transfers,aliasOrAddress:aliasOrAddress,data:data,script:script,binary:binary,precision:precision}},{"@waves/data-entities":undefined,"@waves/signature-generator":undefined}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _1=require("./");function default_1(forSign){var prepare=_1.getSchemaByType(forSign.type).sign;var dataForSign=prepare(forSign.data);var signatureGenerator=new _1.SIGN_TYPES[forSign.type].signatureGenerator(dataForSign);return signatureGenerator.getBytes()}exports.default=default_1},{"./":14}],14:[function(require,module,exports){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}Object.defineProperty(exports,"__esModule",{value:true});__export(require("./constants"));__export(require("./prepare"));__export(require("./schemas"));__export(require("./getTxBytes"))},{"./constants":10,"./getTxBytes":13,"./prepare":15,"./schemas":16}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var data_entities_1=require("@waves/data-entities");var signature_generator_1=require("@waves/signature-generator");var fieldValidator_1=require("./fieldValidator");var normalizeAssetId=function(id){return id===signature_generator_1.WAVES_ID?"":id};var prepare;(function(prepare){var processors;(function(processors){function scriptProcessor(code){return!!(code||"").replace("base64:","")?code:null}processors.scriptProcessor=scriptProcessor;function assetPair(data){return{amountAsset:normalizeAssetId(data.amount.asset.id),priceAsset:normalizeAssetId(data.price.asset.id)}}processors.assetPair=assetPair;function signatureFromProof(proofs){return proofs[0]}processors.signatureFromProof=signatureFromProof;function toBigNumber(some){switch(typeof some){case"string":case"number":return new data_entities_1.BigNumber(some);case"object":if(some instanceof data_entities_1.BigNumber){return some}else{return some.getCoins()}}}processors.toBigNumber=toBigNumber;function toSponsorshipFee(moeny){var coins=moeny.getCoins();if(coins.eq(0)){return null}else{return coins}}processors.toSponsorshipFee=toSponsorshipFee;function moneyToAssetId(money){return money.asset.id}processors.moneyToAssetId=moneyToAssetId;function moneyToNodeAssetId(money){return idToNode(money.asset.id)}processors.moneyToNodeAssetId=moneyToNodeAssetId;function timestamp(time){if(!+time&&typeof time==="string"){return Date.parse(time)}return time&&time instanceof Date?time.getTime():time}processors.timestamp=timestamp;function orString(data){return data||""}processors.orString=orString;function noProcess(data){return data}processors.noProcess=noProcess;function recipient(data){var code=String.fromCharCode(signature_generator_1.config.get("networkByte"));return data.length<30?"alias:"+code+":"+data:data}processors.recipient=recipient;function attachment(data){data=data||"";var value=Uint8Array.from(signature_generator_1.libs.converters.stringToByteArray(data));return signature_generator_1.libs.base58.encode(Uint8Array.from(value))}processors.attachment=attachment;function addValue(value){return typeof value==="function"?value:function(){return value}}processors.addValue=addValue;function expiration(date){return date||(new Date).setDate((new Date).getDate()+20)}processors.expiration=expiration;function transfers(recipient,amount){return function(transfers){return transfers.map(function(transfer){return{recipient:recipient(transfer.recipient),amount:amount(transfer.amount)}})}}processors.transfers=transfers;function quantity(data){return new data_entities_1.BigNumber(data.quantity).times(new data_entities_1.BigNumber(10).pow(data.precision))}processors.quantity=quantity;function base64(str){return(str||"").replace("base64:","")}processors.base64=base64;function toOrderPrice(order){var assetPair=new data_entities_1.AssetPair(order.amount.asset,order.price.asset);var orderPrice=data_entities_1.OrderPrice.fromTokens(order.price.toTokens(),assetPair);return orderPrice.getMatcherCoins()}processors.toOrderPrice=toOrderPrice})(processors=prepare.processors||(prepare.processors={}));function wrap(from,to,cb){if(typeof cb!="function"){return{from:from,to:to,cb:function(){return cb}}}return{from:from,to:to,cb:cb}}prepare.wrap=wrap;function schema(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}return function(data){return args.map(function(item){return typeof item==="string"?{key:item,value:processors.noProcess(data[item])}:{key:item.to,value:item.cb(item.from?data[item.from]:data)}}).reduce(function(result,item){result[item.key]=item.value;return result},Object.create(null))}}prepare.schema=schema;function signSchema(args){return function(data,validate){if(validate===void 0){validate=false}var errors=[];var prepareData=args.map(function(item){var wrapped=wrap(item.name,item.field,item.processor||processors.noProcess);var validateOptions={key:wrapped.to,value:wrapped.from?data[wrapped.from]:data,optional:item.optional,type:item.type,name:item.name};var validator=fieldValidator_1.VALIDATORS[validateOptions.type];try{if(validate&&validator){validator(validateOptions)}return{key:validateOptions.key,value:wrapped.cb(validateOptions.value)}}catch(e){errors.push(e)}return{key:validateOptions.key,value:null}}).reduce(function(result,_a){var key=_a.key,value=_a.value;result[key]=value;return result},Object.create(null));if(errors.length){throw errors}return prepareData}}prepare.signSchema=signSchema;function idToNode(id){return id===signature_generator_1.WAVES_ID?"":id}prepare.idToNode=idToNode})(prepare=exports.prepare||(exports.prepare={}))},{"./fieldValidator":12,"@waves/data-entities":undefined,"@waves/signature-generator":undefined}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _a;var prepare_1=require("./prepare");var constants_1=require("./constants");var signature_generator_1=require("@waves/signature-generator");var fieldsType=require("./fieldTypes");var schema=prepare_1.prepare.schema,wrap=prepare_1.prepare.wrap,signSchema=prepare_1.prepare.signSchema,processors=prepare_1.prepare.processors;var SIGN_SCHEMA=(_a={},_a[constants_1.SIGN_TYPE.MATCHER_ORDERS]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.AUTH]=[fieldsType.string("prefix",null,processors.addValue("WavesWalletAuthentication"),true),fieldsType.string("host"),fieldsType.string("data")],_a[constants_1.SIGN_TYPE.COINOMAT_CONFIRMATION]=[fieldsType.string("prefix",null,processors.addValue("Coinomat"),true),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.CREATE_ORDER]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.string("matcherPublicKey"),fieldsType.money("amount","amountAsset",processors.moneyToAssetId),fieldsType.money("price","priceAsset",processors.moneyToAssetId),fieldsType.orderType("orderType"),fieldsType.money("amount","amount",processors.toBigNumber),fieldsType.fromData(null,"price",processors.toOrderPrice),fieldsType.numberLike("matcherFee",null,processors.toBigNumber),fieldsType.timestamp("expiration",null,processors.expiration),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.CANCEL_ORDER]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.string("id","orderId")],_a[constants_1.SIGN_TYPE.ISSUE]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.assetName("name"),fieldsType.assetDescription("description"),fieldsType.number("chainId",null,processors.addValue(function(){return signature_generator_1.config.getNetworkByte()}),true),fieldsType.numberLike("quantity",null,processors.toBigNumber),fieldsType.precision("precision"),fieldsType.boolean("reissuable"),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.REISSUE]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.number("chainId",null,processors.addValue(function(){return signature_generator_1.config.getNetworkByte()}),true),fieldsType.asset("assetId"),fieldsType.numberLike("quantity",null,processors.toBigNumber),fieldsType.boolean("reissuable"),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.BURN]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.number("chainId",null,processors.addValue(function(){return signature_generator_1.config.getNetworkByte()}),true),fieldsType.asset("assetId"),fieldsType.numberLike("amount","quantity",processors.toBigNumber),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.SPONSORSHIP]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.money("minSponsoredAssetFee","assetId",processors.moneyToAssetId),fieldsType.numberLike("minSponsoredAssetFee",null,processors.toBigNumber),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.TRANSFER]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.money("amount","assetId",processors.moneyToAssetId),fieldsType.required("amount",null,processors.toBigNumber),fieldsType.money("fee","feeAssetId",processors.moneyToAssetId),fieldsType.required("fee","fee",processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp),fieldsType.aliasOrAddress("recipient"),fieldsType.attachment("attachment",null,processors.orString,true)],_a[constants_1.SIGN_TYPE.LEASE]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.number("chainId",null,processors.addValue(function(){return signature_generator_1.config.getNetworkByte()}),true),fieldsType.aliasOrAddress("recipient"),fieldsType.numberLike("amount",null,processors.toBigNumber),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.CANCEL_LEASING]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.number("chainId",null,processors.addValue(function(){return signature_generator_1.config.getNetworkByte()}),true),fieldsType.string("leaseId","transactionId"),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.CREATE_ALIAS]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.aliasName("alias"),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.MASS_TRANSFER]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.money("totalAmount","assetId",processors.moneyToAssetId),fieldsType.transfers("transfers",null,processors.transfers(processors.noProcess,processors.toBigNumber)),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.attachment("attachment",null,processors.orString,true),fieldsType.timestamp("timestamp",null,processors.timestamp)],_a[constants_1.SIGN_TYPE.DATA]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp),fieldsType.data("data")],_a[constants_1.SIGN_TYPE.SET_SCRIPT]=[fieldsType.string("senderPublicKey",null,null,true),fieldsType.numberLike("fee",null,processors.toBigNumber),fieldsType.timestamp("timestamp",null,processors.timestamp),fieldsType.number("chainId",null,processors.addValue(function(){return signature_generator_1.config.getNetworkByte()}),true),fieldsType.script("script")],_a[constants_1.SIGN_TYPE.EXCHANGE]=[],_a);var schemas;(function(schemas){var api;(function(api){api.coinomatConfirmation=schema(wrap("prefix","prefix",processors.addValue("Coinomat")),"timestamp");api.createOrder=schema("matcherPublicKey","orderType",wrap(null,"assetPair",processors.assetPair),wrap(null,"price",processors.toOrderPrice),wrap("amount","amount",processors.toBigNumber),wrap("matcherFee","matcherFee",processors.toBigNumber),wrap("expiration","expiration",processors.expiration),"senderPublicKey","timestamp",wrap("proofs","signature",processors.signatureFromProof));api.cancelOrder=schema(wrap("id","orderId",processors.noProcess),wrap("senderPublicKey","sender",processors.noProcess),wrap("proofs","signature",processors.signatureFromProof));api.issue=schema(wrap("version","version",processors.addValue(2)),wrap("chainId","chainId",processors.addValue(function(){return signature_generator_1.config.getNetworkByte()})),"senderPublicKey","name","description",wrap("quantity","quantity",processors.toBigNumber),wrap("precision","decimals",processors.noProcess),wrap("reissuable","reissuable",processors.noProcess),wrap("fee","fee",processors.toBigNumber),wrap("timestamp","timestamp",processors.timestamp),wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.ISSUE)),"proofs");api.transfer=schema(wrap("version","version",processors.addValue(2)),wrap("amount","assetId",processors.moneyToNodeAssetId),wrap("amount","amount",processors.toBigNumber),wrap("fee","feeAssetId",processors.moneyToNodeAssetId),wrap("fee","fee",processors.toBigNumber),wrap("recipient","recipient",processors.recipient),wrap("attachment","attachment",processors.attachment),wrap("timestamp","timestamp",processors.timestamp),"senderPublicKey","proofs",wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.TRANSFER)));api.reissue=schema(wrap("version","version",processors.addValue(2)),"senderPublicKey",wrap("chainId","chainId",processors.addValue(function(){return signature_generator_1.config.getNetworkByte()})),wrap("assetId","assetId",processors.noProcess),wrap("quantity","quantity",processors.toBigNumber),wrap("reissuable","reissuable",processors.noProcess),wrap("fee","fee",processors.toBigNumber),wrap("timestamp","timestamp",processors.timestamp),"proofs",wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.REISSUE)));api.burn=schema(wrap("version","version",processors.addValue(2)),wrap("chainId","chainId",processors.addValue(function(){return signature_generator_1.config.getNetworkByte()})),"senderPublicKey",wrap("assetId","assetId",processors.noProcess),wrap("amount","quantity",processors.toBigNumber),wrap("fee","fee",processors.toBigNumber),wrap("timestamp","timestamp",processors.timestamp),"proofs",wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.BURN)));api.lease=schema(wrap("version","version",processors.addValue(2)),wrap("chainId","chainId",processors.addValue(function(){return signature_generator_1.config.getNetworkByte()})),"senderPublicKey",wrap("recipient","recipient",processors.recipient),wrap("amount","amount",processors.toBigNumber),wrap("fee","fee",processors.toBigNumber),wrap("timestamp","timestamp",processors.timestamp),"proofs",wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.LEASE)));api.cancelLeasing=schema(wrap("version","version",processors.addValue(2)),wrap("chainId","chainId",processors.addValue(function(){return signature_generator_1.config.getNetworkByte()})),"senderPublicKey",wrap("fee","fee",processors.toBigNumber),wrap("timestamp","timestamp",processors.timestamp),wrap("leaseId","leaseId",processors.noProcess),"proofs",wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.CANCEL_LEASING)));api.alias=schema(wrap("version","version",processors.addValue(2)),"senderPublicKey",wrap("alias","alias",processors.noProcess),wrap("fee","fee",processors.toBigNumber),wrap("timestamp","timestamp",processors.timestamp),"proofs",wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.CREATE_ALIAS)));api.massTransfer=schema("senderPublicKey",wrap("version","version",processors.addValue(1)),wrap("totalAmount","assetId",processors.moneyToNodeAssetId),wrap("transfers","transfers",processors.transfers(processors.recipient,processors.toBigNumber)),wrap("timestamp","timestamp",processors.timestamp),wrap("fee","fee",processors.toBigNumber),wrap("attachment","attachment",processors.attachment),wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.MASS_TRANSFER)),"proofs");api.data=schema(wrap("version","version",processors.addValue(1)),"senderPublicKey","data",wrap("fee","fee",processors.toBigNumber),wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.DATA)),wrap("timestamp","timestamp",processors.timestamp),"proofs");api.setScript=schema(wrap("version","version",processors.addValue(1)),"senderPublicKey",wrap("script","script",processors.scriptProcessor),wrap("chainId","chainId",processors.addValue(function(){return signature_generator_1.config.get("networkByte")})),wrap("fee","fee",processors.toBigNumber),wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.SET_SCRIPT)),wrap("timestamp","timestamp",processors.timestamp),"proofs");api.sponsorship=schema(wrap("version","version",processors.addValue(1)),"senderPublicKey",wrap("minSponsoredAssetFee","assetId",processors.moneyToAssetId),wrap("minSponsoredAssetFee","minSponsoredAssetFee",processors.toSponsorshipFee),wrap("fee","fee",processors.toBigNumber),wrap("type","type",processors.addValue(constants_1.SIGN_TYPE.SPONSORSHIP)),wrap("timestamp","timestamp",processors.timestamp),"proofs")})(api=schemas.api||(schemas.api={}));var sign;(function(sign){sign.matcherOrders=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.MATCHER_ORDERS]);sign.auth=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.AUTH]);sign.coinomatConfirmation=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.COINOMAT_CONFIRMATION]);sign.createOrder=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.CREATE_ORDER]);sign.cancelOrder=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.CANCEL_ORDER]);sign.issue=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.ISSUE]);sign.transfer=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.TRANSFER]);sign.reissue=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.REISSUE]);sign.burn=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.BURN]);sign.lease=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.LEASE]);sign.cancelLeasing=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.CANCEL_LEASING]);sign.alias=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.CREATE_ALIAS]);sign.massTransfer=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.MASS_TRANSFER]);sign.data=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.DATA]);sign.setScript=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.SET_SCRIPT]);sign.sponsorship=signSchema(SIGN_SCHEMA[constants_1.SIGN_TYPE.SPONSORSHIP]);sign.exchange=function(data){console.warn("Sign exchange transaction is not supported!");return data}})(sign=schemas.sign||(schemas.sign={}))})(schemas||(schemas={}));var hasNoApiMethod=function(schemaType){return function(){throw new Error("Has no method for prepare "+schemaType)}};function getSchemaByType(type){switch(type){case constants_1.SIGN_TYPE.MATCHER_ORDERS:return{api:hasNoApiMethod("api, get orders"),sign:schemas.sign.matcherOrders};case constants_1.SIGN_TYPE.AUTH:return{api:hasNoApiMethod("api auth"),sign:schemas.sign.auth};case constants_1.SIGN_TYPE.COINOMAT_CONFIRMATION:return{api:schemas.api.coinomatConfirmation,sign:schemas.sign.coinomatConfirmation};case constants_1.SIGN_TYPE.CREATE_ORDER:return{api:schemas.api.createOrder,sign:schemas.sign.createOrder};case constants_1.SIGN_TYPE.CANCEL_ORDER:return{api:schemas.api.cancelOrder,sign:schemas.sign.cancelOrder};case constants_1.SIGN_TYPE.TRANSFER:return{api:schemas.api.transfer,sign:schemas.sign.transfer};case constants_1.SIGN_TYPE.ISSUE:return{api:schemas.api.issue,sign:schemas.sign.issue};case constants_1.SIGN_TYPE.REISSUE:return{api:schemas.api.reissue,sign:schemas.sign.reissue};case constants_1.SIGN_TYPE.BURN:return{api:schemas.api.burn,sign:schemas.sign.burn};case constants_1.SIGN_TYPE.EXCHANGE:return{api:hasNoApiMethod("api, exchange"),sign:schemas.sign.exchange};case constants_1.SIGN_TYPE.LEASE:return{api:schemas.api.lease,sign:schemas.sign.lease};case constants_1.SIGN_TYPE.CANCEL_LEASING:return{api:schemas.api.cancelLeasing,sign:schemas.sign.cancelLeasing};case constants_1.SIGN_TYPE.CREATE_ALIAS:return{api:schemas.api.alias,sign:schemas.sign.alias};case constants_1.SIGN_TYPE.MASS_TRANSFER:return{api:schemas.api.massTransfer,sign:schemas.sign.massTransfer};case constants_1.SIGN_TYPE.DATA:return{api:schemas.api.data,sign:schemas.sign.data};case constants_1.SIGN_TYPE.SET_SCRIPT:return{api:schemas.api.setScript,sign:schemas.sign.setScript};case constants_1.SIGN_TYPE.SPONSORSHIP:return{api:schemas.api.sponsorship,sign:schemas.sign.sponsorship}}}exports.getSchemaByType=getSchemaByType},{"./constants":10,"./fieldTypes":11,"./prepare":15,"@waves/signature-generator":undefined}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function find(some,list){var keys=Object.keys(some);var isEqual=function(a){return keys.every(function(n){return a[n]===some[n]})};for(var i=0;i<list.length;i++){if(isEqual(list[i])){return list[i]}}return null}exports.find=find},{}]},{},[9])(9)});