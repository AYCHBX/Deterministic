"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const transactions_1 = require("../transactions");
const waves_crypto_1 = require("waves-crypto");
const generic_1 = require("../generic");
const marshall_1 = require("@waves/marshall");
function setScript(paramsOrTx, seed) {
    const type = transactions_1.TRANSACTION_TYPE.SET_SCRIPT;
    const version = paramsOrTx.version || 1;
    const seedsAndIndexes = generic_1.convertToPairs(seed);
    const senderPublicKey = generic_1.getSenderPublicKey(seedsAndIndexes, paramsOrTx);
    if (paramsOrTx.script === undefined)
        throw new Error('Script field cannot be undefined. Use null explicitly to remove script');
    const tx = {
        type,
        version,
        senderPublicKey,
        chainId: generic_1.networkByte(paramsOrTx.chainId, 87),
        fee: generic_1.fee(paramsOrTx, 1000000),
        timestamp: paramsOrTx.timestamp || Date.now(),
        proofs: paramsOrTx.proofs || [],
        id: '',
        script: generic_1.base64Prefix(paramsOrTx.script),
    };
    const bytes = marshall_1.binary.serializeTx(tx);
    seedsAndIndexes.forEach(([s, i]) => generic_1.addProof(tx, waves_crypto_1.signBytes(bytes, s), i));
    tx.id = waves_crypto_1.hashBytes(bytes);
    return tx;
}
exports.setScript = setScript;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0LXNjcmlwdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90cmFuc2FjdGlvbnMvc2V0LXNjcmlwdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtEQUErRztBQUMvRywrQ0FBb0Q7QUFDcEQsd0NBQXlHO0FBRXpHLDhDQUF3QztBQTJDeEMsU0FBZ0IsU0FBUyxDQUFDLFVBQWUsRUFBRSxJQUFpQjtJQUMxRCxNQUFNLElBQUksR0FBRywrQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFDekMsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUM7SUFDeEMsTUFBTSxlQUFlLEdBQUcsd0JBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QyxNQUFNLGVBQWUsR0FBRyw0QkFBa0IsQ0FBQyxlQUFlLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDeEUsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLFNBQVM7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHdFQUF3RSxDQUFDLENBQUE7SUFFOUgsTUFBTSxFQUFFLEdBQW1DO1FBQ3pDLElBQUk7UUFDSixPQUFPO1FBQ1AsZUFBZTtRQUNmLE9BQU8sRUFBRSxxQkFBVyxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDO1FBQzVDLEdBQUcsRUFBRSxhQUFHLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQztRQUM3QixTQUFTLEVBQUUsVUFBVSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFO1FBQzdDLE1BQU0sRUFBRSxVQUFVLENBQUMsTUFBTSxJQUFJLEVBQUU7UUFDL0IsRUFBRSxFQUFFLEVBQUU7UUFDTixNQUFNLEVBQUUsc0JBQVksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO0tBQ3hDLENBQUE7SUFFRCxNQUFNLEtBQUssR0FBRyxpQkFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVyQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFRLENBQUMsRUFBRSxFQUFFLHdCQUFTLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEUsRUFBRSxDQUFDLEVBQUUsR0FBRyx3QkFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRXpCLE9BQU8sRUFBRSxDQUFBO0FBQ1gsQ0FBQztBQXpCRCw4QkF5QkMifQ==