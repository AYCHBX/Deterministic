<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/parsePrimitives.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">src</a> parsePrimitives.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">92.78% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>90/97</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">52.38% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>22/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>24/25</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.18% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>62/68</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116</td><td class="line-coverage quiet"><span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22x</span>
<span class="cline-any cline-yes">22x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">207x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">64x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">126x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">34x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">70x</span>
<span class="cline-any cline-yes">70x</span>
<span class="cline-any cline-yes">70x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-yes">26x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import * as Long from "long";
import {Utf8ArrayToStr} from './libs/Utf8ArrayToStr'
import base58 from './libs/base58';
import * as Base64 from "base64-js"
&nbsp;
export const ALIAS_VERSION: number = 2;
&nbsp;
const LENGTH_SIZE = 2;
&nbsp;
type Option&lt;T&gt; = T | null | undefined
&nbsp;
export type TParser&lt;T&gt; = (bytes: Uint8Array, start?: number) =&gt; { value: T, shift: number }
&nbsp;
export const P_OPTION = &lt;T&gt;(p: TParser&lt;T&gt;): TParser&lt;Option&lt;T&gt;&gt; =&gt; (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start = 0) =&gt; {
  if (bytes[start] === 0) return {value: undefined, shift: 1};
  const result = p(bytes, start + 1);
  return {value: result.value, shift: result.shift + 1}
};
&nbsp;
&nbsp;
export const P_BYTE: TParser&lt;number&gt; = (bytes, start = 0) =&gt; ({value: bytes[start], shift: 1});
&nbsp;
export const P_SHORT: TParser&lt;number&gt; = (bytes, <span class="missing-if-branch" title="if path not taken" >I</span>start = 0) =&gt; ({value: 256 * bytes[start] + bytes[start + 1], shift: 2});
&nbsp;
export const P_INT: TParser&lt;number&gt; = (bytes, <span class="missing-if-branch" title="if path not taken" >I</span>start = 0) =&gt; ({value: 2**24 * bytes[start] + 2**16 * bytes[start + 1] +  2**8 * bytes[start + 2] +  bytes[start + 3], shift: 4});
&nbsp;
export const P_LONG: TParser&lt;string&gt; = (bytes, <span class="missing-if-branch" title="if path not taken" >I</span>start = 0) =&gt; ({
  value: Long.fromBytesBE(Array.from(bytes.slice(start, start + 8))).toString(),
  shift: 8
});
&nbsp;
export const P_BOOLEAN = (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start = 0) =&gt; {
  const value = !!bytes[start];
  return {value, shift: 1};
};
&nbsp;
export const P_STRING_FIXED = (len: number): TParser&lt;string&gt; =&gt; (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const value = Utf8ArrayToStr(bytes.slice(start, start + len));
  return {shift: len, value};
};
&nbsp;
export const P_STRING_VAR = (lenParser: TParser&lt;number&gt;) =&gt; (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const lengthInfo = lenParser(bytes, start);
  const {value} = P_STRING_FIXED(lengthInfo.value)(bytes, start + lengthInfo.shift);
  return {shift: lengthInfo.value + lengthInfo.shift, value};
};
&nbsp;
export const P_BASE58_FIXED = (len: number): TParser&lt;string&gt; =&gt; (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const value = base58.encode(bytes.slice(start, start + len));
  return {value, shift: len};
};
&nbsp;
export const P_BASE58_VAR = (lenParser: TParser&lt;number&gt;) =&gt; (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const lengthInfo = lenParser(bytes, start);
  const {value} = P_BASE58_FIXED(lengthInfo.value)(bytes, start + LENGTH_SIZE);
  return {shift: lengthInfo.value + LENGTH_SIZE, value};
};
&nbsp;
export const P_BASE64 = (lenParser: TParser&lt;number&gt;) =&gt; (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const lengthInfo = lenParser(bytes, start);
  const value = `base64:${ Base64.fromByteArray(bytes.slice(start + lengthInfo.shift, start + lengthInfo.shift + lengthInfo.value))}`;
  return {shift: lengthInfo.value + lengthInfo.shift, value};
};
&nbsp;
const byteToString = (shift: number) =&gt; (bytes: Uint8Array, start: number) =&gt; {
  const value = Utf8ArrayToStr(bytes.slice(start, start + shift));
  return {shift, value};
};
&nbsp;
export const byteToStringWithLength = (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const lengthInfo = P_SHORT(bytes, start);
  const {value} = byteToString(lengthInfo.value)(bytes, start + LENGTH_SIZE);
  return {shift: lengthInfo.value + LENGTH_SIZE, value};
};
&nbsp;
export const byteToBase58 = (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0, length?: number) =&gt; { // TODO!
  const shift = length || <span class="branch-1 cbranch-no" title="branch not covered" >32;</span>
  const value = base58.encode(bytes.slice(start, start + shift));
  return {value, shift};
};
export const byteToBase58WithLength = <span class="fstat-no" title="function not covered" >(</span>bytes: Uint8Array, <span class="cstat-no" title="statement not covered" >start: number = 0)</span> =&gt; { // TODO!
  const lenInfo = <span class="cstat-no" title="statement not covered" >P_SHORT(bytes, start)</span>
  const value = <span class="cstat-no" title="statement not covered" >base58.encode(bytes.slice(start + lenInfo.shift, start + lenInfo.shift + lenInfo.value));</span>
<span class="cstat-no" title="statement not covered" >  return {value, shift: lenInfo.shift + lenInfo.value};</span>
};
&nbsp;
export const byteToAddressOrAlias = (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (bytes[start] === ALIAS_VERSION) {
    const aliasData = <span class="cstat-no" title="statement not covered" >byteToStringWithLength(bytes, start + 2);</span>
<span class="cstat-no" title="statement not covered" >    return {shift: aliasData.shift + 2, value: aliasData.value};</span>
  } else {
    return byteToBase58(bytes, start, 26);
  }
};
&nbsp;
export const byteNewAliasToString = (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const shift = P_SHORT(bytes, start).value + LENGTH_SIZE;
  const {value} = byteToStringWithLength(bytes, start);
  return {shift, value};
};
&nbsp;
export const byteToScript = (bytes: Uint8Array, <span class="missing-if-branch" title="if path not taken" >I</span>start: number = 0) =&gt; {
  const VERSION_LENGTH = 1;
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if (bytes[start] === 0) {
<span class="cstat-no" title="statement not covered" >    return {shift: VERSION_LENGTH, value: null};</span>
  }
&nbsp;
  const lengthInfo = P_SHORT(bytes, start + VERSION_LENGTH);
  const from = start + VERSION_LENGTH + lengthInfo.shift;
  const to = start + VERSION_LENGTH + lengthInfo.shift + lengthInfo.value;
  const value = `base64:${Base64.fromByteArray(bytes.slice(from, to))}`;
&nbsp;
  return {value, shift: to - start};
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Thu Dec 20 2018 16:41:56 GMT+0300 (Moscow Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
